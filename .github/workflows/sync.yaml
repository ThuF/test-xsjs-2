name: Synchronize Content
on:
  workflow_dispatch
#   schedule:
#     - cron:  '0/5 * * ? *'
jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          token: ${{secrets.GH_TOKEN}}
          ref: gh-pages
      - name: Sync Content
        run: |
          mkdir sync
          cd sync/
          git clone https://github.com/sap/xsk
          cd xsk/
          git checkout gh-pages
          cp -R * ../../
          cd ../..
          rm -rf sync/
      - name: Git Config
        run: |
          git config user.name ${{secrets.GH_USER_NAME}}
          git config user.email ${{secrets.GH_USER_EMAIL}}
      - name: Calculate Changes
        id: calculate-changes
        run: |
          git add .
          HAVE_CHANGES=$(git diff HEAD)
          if [ "$HAVE_CHANGES" == "" ]; then
            echo ::set-output name=have-changes::false
          else
            echo ::set-output name=have-changes::true
          fi
      - name: Commit and Push Changes
        if: ${{ steps.calculate-changes.outputs.have-changes }}
        run: |
          git commit -m "Sync Content"
          git push origin gh-pages
          
